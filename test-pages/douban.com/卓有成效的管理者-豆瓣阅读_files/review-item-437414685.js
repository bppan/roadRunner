Do.ready("mod/ajax","mod/lang","jquery:replace-class","mod/template",function(){var h=$(".review-item .btn-view-detail"),c="collapsed",e="expanded",b=Ark.ajax,i=Ark._,j=Ark.template($("#share-button-tmpl").html()),d=Ark.template($("#impression-actions-tmpl").html());var f=function(n,m){if(n.data("processing")){return $.Deferred().reject()}n.data("processing",true);var k=m.data("review-id"),l=m.data("review-name");return b({type:"GET",url:["","j",l,k].join("/"),dataType:"json"}).done(function(t){var r=i.escape(t.text).replace(/\r\n|\n/g,"<br>"),u=n.find(".desc"),p=u.find(".comments-num").clone(),s="<p>"+r.split("<br>").join("</p><p>")+"</p>",q={reviewId:k};i.extend(q,t,{shareButtonTmpl:j({reviewId:k,isLogined:t.isLogined})});n.data("detailHasLoaded",true);var o=$("<div>",{"class":"desc-detail",html:s}).append(p);if(l==="review"){o.after(d(q))}u.after(o);n.data("processing",false)}).fail(function(){n.data("processing",false)})},g=function(l,k){l.replaceClass(c,e);k.find(".triangle-bottom").replaceClass("triangle-bottom","triangle-top")},a=function(l,k){l.replaceClass(e,c);k.find(".triangle-top").replaceClass("triangle-top","triangle-bottom")};h.click(function(){var l=$(this),m=l.parents(".review-item");if(m.hasClass(c)){var k=m.data("detailHasLoaded")?$.Deferred().resolve():f(m,l);k.done(function(){g(m,l)})}else{a(m,l)}})});Do.ready("widget/vote",function(){var a=new Ark.vote({applyTo:$(".read-review-list"),voteBtnSelector:".btn-vote",onVoted:function(c,d){var b=c.closest(".review-item").find(".simple-impression");b.find(".voted-num").text(d+"有用")}})});
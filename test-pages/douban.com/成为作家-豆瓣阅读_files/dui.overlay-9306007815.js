(function(exports){var current,dui=exports.dui||{},win=$(window),doc=$(document),isFirefox=/firefox/i.test(navigator.userAgent),ID_CONTAINER="#dui-overlay-container",CLASS_PANEL="dui-overlay-panel",TEMPL_OVERLAY=['<div class="dui-overlay-mask" style="background:{{bgcolor}}"></div>','<div id="',ID_CONTAINER.replace("#",""),'" class="dui-overlay-container"></div>'].join(""),TEMPL_PANEL=['<div class="dui-overlay-panel" style="width:{{width}}px">','<div class="hd">{{title}}{{bn-overlay-close}}</div>','<div class="bd">{{content}}</div>','<div class="ft">{{footer}}</div>',"</div>"].join(""),TEMPL_PANEL_TITLE="<h2>{{title}}</h2>",TEMPL_PANEL_BN_CLOSE='<a href="#" class="lnk-close">&times;</a>',defaultConfig={width:600,bgColor:"#000",title:"",content:"",footer:"",klass:"",closable:!0},_initEvents=function(obj){$.each(["on","off","trigger","one"],function(k,v){obj.prototype[v]=function(){return $.fn[v].apply(this._events,arguments)}})},overlay=function(cfg){this._events=$(this),this.setConfig(cfg),this.on("overlay:content_change",this.checkContentChange).on("overlay:init_end",this.checkContentChange).on("overlay:init_end",function(){this.config.closable&&this.panel.on("click",".lnk-close",$.proxy(function(e){e.preventDefault(),this.close()},this))});var self=this;win.resize(function(){self.checkContentChange()}),this.config.closable&&doc.on("click",function(e){"dui-overlay-container"===e.target.className&&self.close()})};overlay.prototype={getConfig:function(){return this.config},setConfig:function(cfg){return this.config=$.extend({},defaultConfig,cfg),this},setContent:function(str){var self=this;return this.panel.find(".bd").html(str),setTimeout(function(){self.trigger("overlay:content_change")},0),this},_setKlass:function(){var cfg=this.config;this.panel.attr("class",cfg.klass?CLASS_PANEL+" "+cfg.klass:CLASS_PANEL)},render:function(){var cfg=this.config,panelHtml=TEMPL_PANEL;return this.hasRendered?(this.panel.css("width",cfg.width+"px"),""===cfg.title?this.panel.find(".hd h2").hide():this.panel.find(".hd h2").show().text(cfg.title),this._setKlass(),""===cfg.footer?this.panel.find(".ft").hide():this.panel.find(".ft").show().html(cfg.footer),this.setContent(cfg.content)):($("body").append(TEMPL_OVERLAY.replace("{{bgcolor}}",cfg.bgColor)),this.container=$(ID_CONTAINER),panelHtml=panelHtml.replace("{{title}}",TEMPL_PANEL_TITLE.replace("{{title}}",cfg.title)).replace("{{width}}",cfg.width).replace("{{content}}",cfg.content).replace("{{footer}}",cfg.footer).replace("{{bn-overlay-close}}",TEMPL_PANEL_BN_CLOSE),this.panel=$(panelHtml).appendTo(this.container),this.config.closable||this.panel.find(".lnk-close").remove(),this._setKlass(),this.nodes=$(".dui-overlay-mask, .dui-overlay-container"),this.trigger("overlay:init_end")),this.hasRendered=1,this.trigger("overlay:render_end"),this},show:function(){var y=$(win)[0].scrollY;$("html").css({height:"auto",overflowX:"hidden",overflowY:"hidden"}),this.hasRendered?this.nodes.show():this.render(),this.trigger("overlay:show"),isFirefox&&$(win)[0].scrollTo(0,y)},close:function(){var y=$(win)[0].scrollY;$("html").removeAttr("style"),this.nodes.hide(),this.trigger("overlay:close"),isFirefox&&$(win)[0].scrollTo(0,y)},checkContentChange:function(){if(this.panel){var h=this.panel.height(),wh=win.height();h>wh?this.panel.css({position:"relative",margin:"50px auto",top:0,left:0}):this.panel.css({position:"absolute",top:wh/2,left:"50%","margin-top":-1*h/2+"px","margin-bottom":0,"margin-left":-1*this.panel.width()/2+"px"})}}},_initEvents(overlay),dui.overlay=function(cfg){return current||(current=new overlay(cfg)),current},exports.dui=dui})(window);
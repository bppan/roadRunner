define("widget/vote",["jquery","mod/ajax","mod/template"],function(e,b,d){e=e||window.$;b=b||Ark.ajax;d=d||Ark.template;var c={applyTo:null,voteBtnSelector:".btn-vote",onVoted:e.noop};var a=function(f){this.options=e.extend({},c,f);this.voteBtnSelector=this.options.voteBtnSelector;this.listen()};e.extend(a.prototype,{vote:function(i,h){i.preventDefault();var g=e(i.currentTarget),f=g.data("review-id"),k=g.closest(".impression"),m=parseInt(g.find(".voted-num").text(),10)||0,j=d('<span class="voted">已投票</span>{{= votedNum}}人觉得这篇评论有用'),l=g.data("hasClicked");if(l){return}g.data("hasClicked",true);b({url:["","j","review",f,"vote"].join("/"),type:"POST"}).done(function(){m=m+1;k.html(j({votedNum:m}));if(h){h(k,m)}})},listen:function(){var g=this;if(this.options.applyTo){this.applyToElement=this.options.applyTo;var h=this.options.onVoted;this.applyToElement.on("click",this.voteBtnSelector,function(i){g.vote(i,h)})}else{var f=e(this.voteBtnSelector);if(!f.length){return}f.click(function(i){g.vote.call(this,i)})}}});return a});
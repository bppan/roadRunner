Do("widget/login-and-signup",function(){if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.host}function c(d){return window.location.origin+"/ebook/"+d.attr("aid")+"/"}var b={present:function(d){return c(d)+"present"},purchase:function(d){return c(d)+"#purchase"},sample:function(d){return c(d)+"#sample"},kindle:function(d){return window.location.origin+"/kindle/apply"}};function a(f){var h=f.data("login-action"),d=window.location.href;if(h){d=b[h];d=$.isFunction(d)?d(f):d}var g=d.split("?"),j=d.split("#"),i=j[1],e=g[1],l=e&&e.split("#")[0],k=l&&g[0]||j[0];if(l){l=l.replace(/[&]?(dcs|dcm)=[^&]*/g,"")}l=(l?l+"&":"")+"dcs=login&dcm=anonymous";d=k+"?"+l+(i?"#"+i:"");document.cookie="refer_url="+d+";domain=douban.com;path=/"}$(".login, .signup, .require-login").click(function(g){g.preventDefault();var f=$(this),d=f.data("target-dialog");Ark.ga.trackEvent("anonymous","loginDialogue");a(f);return new Ark.loginAndSignup({type:d,context:"store"})})});
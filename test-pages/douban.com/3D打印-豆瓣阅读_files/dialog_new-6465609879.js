define("ui/dialog_new",["jquery","ui/overlay","mod/emitter"],function($,overlay,Emitter){function Dialog(opts){Emitter.call(this);var self=this;this.opts=opts,this.el=$(tmpl),this.text=this.el.find(".k-text"),this.head=this.el.find(".dialog-hd"),this.buttons=this.el.find(".k-buttons"),this.btnClose=this.el.find(".k-close"),this.closable=void 0!==opts.closable?!!opts.closable:!0,this.overlay=overlay({closable:this.closable}),this.render(),doc.on("click.close",".k-close",function(){self.close()}).on("click.confirm","[data-confirm]",function(e){var action=!!$(e.currentTarget).data("confirm");self.emit(action?"confirm":"cancel"),action||self.close()})}function exports(opts){return opts=opts||{},new exports.Dialog(opts)}var tmpl='<div id="ark-dialog"><div class="dialog-hd"><a href="#" class="k-close">&times;</a></div><div class="dialog-bd"><div class="k-text"></div><div class="k-buttons"></div></div></div>',tmplBtns='<button class="btn btn-large" data-confirm="1">确定</button><button class="btn btn-minor btn-large" data-confirm="0">取消</button>',doc=$(document);return $.extend(Dialog.prototype,{render:function(){var title=this.opts.title,foot=this.opts.foot;this.text.html(this.opts.content),this.closable||this.btnClose.remove(),title&&this.setTitle(title),foot&&this.setFoot(foot),this.setButtons(),this.overlay.setBody(this.el)},setTitle:function(title){return this.head.prepend($("<span>",{"class":"k-title",text:title})),this},setFoot:function(content){return this.el.append($("<div>",{"class":"dialog-ft",html:content})),this},setButtons:function(config){config=config||[];var type=this.opts.type,btnText=["确定","取消"],btnNum=config.length;if(/confirm|tips/i.test(type)){this.buttons[0].innerHTML=tmplBtns;for(var buttons=this.buttons.find("button"),i=0;btnNum>i;i++)buttons.eq(i).text(config[i].text||btnText[i]).addClass(config[i]["class"]||"");"tips"===type&&$(buttons[1]).remove()}return"custom"===type&&(this.buttons[0].innerHTML=config),this},addClass:function(name){return this.el.addClass(name),this},open:function(){return this.overlay.open(),this.emit("open"),this},close:function(){return this.overlay.close(),this.emit("close"),doc.off(".confirm"),this}}),Emitter(Dialog.prototype),exports.Dialog=Dialog,exports});